# Платформа духовного опыта - Обновление с экспертами

## Новые возможности

### 1. Разделение пользователей на типы
- **Пользователи** - могут искать экспертов и оставлять отзывы
- **Эксперты** - могут создавать статьи, получать заявки от клиентов

### 2. Расширенная регистрация
- Выбор типа аккаунта при регистрации (Пользователь/Эксперт)
- Визуальные карточки для выбора типа

### 3. Расширенный профиль эксперта
- **Обязательные поля:**
  - Описание услуг
  - Номер телефона
  - Город (⚠️ без города эксперта не найдут в поиске)
  - Типы консультаций (Онлайн/Оффлайн)
  - Направления деятельности (29 категорий)

- **Категории направлений:**
  - Регресс, Парапсихология, Расстановки
  - Хьюман дизайн, МАК карты, Таро, Руны
  - Карты Ленорман, Астрология, Нумерология
  - Тетахилинг, Космоэнергетика, Рейки
  - Шаманизм, Славянские практики, Звукотерапия
  - Целительство, Женские практики, Йога
  - Гвоздестояние, Тантра практики, Нутрициология
  - Ароматерапия, Квантовая психология, Медитация
  - Нейрографика, Мандалы, Литотерапия, Кинезиология

### 4. Система поиска экспертов
- **Фильтры:**
  - Поиск по имени, описанию, городу
  - Фильтр по направлениям деятельности
  - Фильтр по городу
  - Сортировка: по рейтингу, новые, по количеству заявок
  - Причина обращения: здоровье, психическое, физическое, раскрытие способностей, наставничество, предсказания, самопознание

### 5. Система отзывов
- Оценка экспертов от 1 до 5 звезд
- Комментарии к отзывам
- Указание причины обращения
- Автоматический расчет рейтинга эксперта

### 6. Система заявок
- Отправка заявок экспертам
- Указание причины обращения
- Статусы заявок: pending, accepted, rejected, completed

### 7. Ограничения для пользователей
- Только эксперты могут создавать статьи
- Пользователи видят уведомление о необходимости стать экспертом

## Настройка базы данных

### 1. Выполните SQL скрипт
Запустите файл `supabase-update.sql` в SQL Editor вашего проекта Supabase:

```sql
-- Скрипт добавляет:
-- - Новые поля в таблицу profiles
-- - Таблицу categories с 29 направлениями
-- - Таблицу expert_categories для связей
-- - Таблицу reviews для отзывов
-- - Таблицу expert_requests для заявок
-- - Политики безопасности (RLS)
-- - Триггеры для автоматического обновления рейтингов
```

### 2. Проверьте настройки RLS
Убедитесь, что включены политики безопасности для всех новых таблиц.

## Использование

### Для пользователей:
1. Зарегистрируйтесь как "Пользователь"
2. Используйте "Поиск экспертов" в навигации
3. Применяйте фильтры для поиска подходящего эксперта
4. Отправляйте заявки экспертам
5. Оставляйте отзывы после получения услуг

### Для экспертов:
1. Зарегистрируйтесь как "Эксперт"
2. Заполните расширенный профиль:
   - Укажите город (обязательно!)
   - Выберите направления деятельности
   - Укажите типы консультаций
   - Добавьте описание услуг
3. Создавайте статьи в разделе "Мои статьи"
4. Получайте заявки от клиентов
5. Отвечайте на заявки

## Компоненты

### Новые компоненты:
- `ExpertSearch.tsx` - Поиск и фильтрация экспертов
- `Reviews.tsx` - Система отзывов
- `ExpertProfile.tsx` - Детальный профиль эксперта

### Обновленные компоненты:
- `AuthForm.tsx` - Добавлен выбор типа пользователя
- `ProfileForm.tsx` - Расширенные поля для экспертов
- `Dashboard.tsx` - Ограничения для пользователей
- `Navigation.tsx` - Добавлен поиск экспертов
- `AuthContext.tsx` - Поддержка типа пользователя

## API Endpoints

### Новые таблицы:
- `categories` - Категории направлений
- `expert_categories` - Связи экспертов с категориями
- `reviews` - Отзывы о экспертах
- `expert_requests` - Заявки к экспертам

### Обновленные поля в `profiles`:
- `user_type` - Тип пользователя (user/expert)
- `phone` - Номер телефона
- `city` - Город
- `description` - Описание услуг
- `accepts_online` - Принимает онлайн консультации
- `accepts_offline` - Принимает оффлайн консультации
- `rating` - Рейтинг эксперта
- `total_reviews` - Количество отзывов
- `total_requests` - Количество заявок

## Безопасность

- Все новые таблицы защищены RLS политиками
- Пользователи могут видеть только свои данные
- Эксперты могут управлять только своими категориями
- Отзывы могут оставлять только авторизованные пользователи

## Производительность

- Автоматические триггеры обновляют рейтинги экспертов
- Индексы на часто используемые поля
- Оптимизированные запросы с JOIN'ами

## Будущие улучшения

- Уведомления о новых заявках
- Календарь для записи на консультации
- Система оплаты
- Чат между экспертами и клиентами
- Мобильное приложение
