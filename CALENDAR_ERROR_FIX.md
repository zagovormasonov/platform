# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ "Could not find a relationship between 'time_slots' and 'profiles'"

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

–û—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –∏–∑-–∑–∞ –ø–æ–ø—ã—Ç–∫–∏ —Å–æ–∑–¥–∞—Ç—å –ø—Ä—è–º—É—é —Å–≤—è–∑—å –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ `time_slots` –∏ `profiles` –≤ Supabase –∑–∞–ø—Ä–æ—Å–µ, –Ω–æ —Ç–∞–∫–æ–π —Å–≤—è–∑–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Å—Ö–µ–º–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

```
Could not find a relationship between 'time_slots' and 'profiles' in the schema cache
```

## üîç –ê–Ω–∞–ª–∏–∑

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–≤—è–∑–µ–π:
```
time_slots.expert_id ‚Üí auth.users.id
auth.users.id ‚Üí profiles.id
```

### –ü—Ä–æ–±–ª–µ–º–Ω—ã–π –∑–∞–ø—Ä–æ—Å:
```tsx
.select(`
  *,
  expert_schedule!inner(duration_minutes),
  profiles!inner(full_name, avatar_url)  // ‚ùå –ü—Ä—è–º–æ–π —Å–≤—è–∑–∏ –Ω–µ—Ç
`)
```

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –†–∞–∑–¥–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (—Ç–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ)

```tsx
// 1. –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ª–æ—Ç—ã —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º
const { data: slotsData } = await supabase
  .from('time_slots')
  .select(`
    *,
    expert_schedule!inner(duration_minutes)
  `)

// 2. –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å —ç–∫—Å–ø–µ—Ä—Ç–∞ –æ—Ç–¥–µ–ª—å–Ω–æ
const { data: expertProfile } = await supabase
  .from('profiles')
  .select('full_name, avatar_url')
  .eq('id', expertId)
  .single()

// 3. –û–±—ä–µ–¥–∏–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –∫–æ–¥–µ
const formattedSlots = slotsData.map(slot => ({
  ...slot,
  expert_name: expertProfile?.full_name,
  expert_avatar: expertProfile?.avatar_url
}))
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: SQL –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ)

#### –°–æ–∑–¥–∞—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ:
```sql
-- supabase-calendar-views-fix.sql
CREATE OR REPLACE VIEW all_slots_view AS
SELECT 
    ts.*,
    p.full_name as expert_name,
    p.avatar_url as expert_avatar,
    es.duration_minutes
FROM time_slots ts
LEFT JOIN profiles p ON p.id = ts.expert_id
LEFT JOIN expert_schedule es ON es.id = ts.schedule_id
WHERE ts.slot_date >= NOW()::date;
```

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∫–æ–¥–µ:
```tsx
const { data } = await supabase
  .from('all_slots_view')  // ‚úÖ –í—Å–µ —Å–≤—è–∑–∏ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
  .select('*')
```

## üîß –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –í ExpertCalendar.tsx:

```tsx
const loadTimeSlots = async (startDate: string, endDate: string) => {
  // –ü—Ä–æ–±—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
  let { data, error } = await supabase
    .from('all_slots_view')
    .select('*')
    .eq('expert_id', expertId)
    .gte('slot_date', startDate)
    .lte('slot_date', endDate)

  // Fallback –µ—Å–ª–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
  if (error && error.code === 'PGRST106') {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞–∑–¥–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
    const { data: slotsData } = await supabase.from('time_slots')...
    const { data: expertProfile } = await supabase.from('profiles')...
    
    // –û–±—ä–µ–¥–∏–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
    data = slotsData.map(slot => ({
      ...slot,
      expert_name: expertProfile?.full_name,
      expert_avatar: expertProfile?.avatar_url
    }))
  }
  
  setTimeSlots(data || [])
}
```

## üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å SQL —Å–∫—Ä–∏–ø—Ç:
```sql
-- –í—ã–ø–æ–ª–Ω–∏—Ç–µ supabase-calendar-views-fix.sql
-- –≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ all_slots_view
```

### 2. –ö–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è:
- ‚úÖ –ï—Å–ª–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ
- ‚úÖ –ï—Å–ª–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –Ω–µ—Ç ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç fallback –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ –í –ª—é–±–æ–º —Å–ª—É—á–∞–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- ‚úÖ **SQL –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ** - –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ –¥–≤—É—Ö
- ‚úÖ **Fallback –ª–æ–≥–∏–∫–∞** - —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î

### –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ** –ø—Ä–∏ –æ—à–∏–±–∫–µ
- ‚úÖ **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å–æ —Å—Ç–∞—Ä–æ–π —Å—Ö–µ–º–æ–π
- ‚úÖ **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –æ—à–∏–±–æ–∫

### –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:
- ‚úÖ **SQL –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** —á–µ—Ä–µ–∑ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏** –∫–æ–¥–∞
- ‚úÖ **–õ–µ–≥–∫–æ—Å—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è** —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ö–∞–ª–µ–Ω–¥–∞—Ä—å —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç:
- ‚úÖ **–í—Å–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã** —ç–∫—Å–ø–µ—Ä—Ç–∞
- ‚úÖ **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —ç–∫—Å–ø–µ—Ä—Ç–µ** (–∏–º—è, –∞–≤–∞—Ç–∞—Ä)
- ‚úÖ **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–Ω—è—Ç–∏–π**
- ‚úÖ **–°—Ç–∞—Ç—É—Å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏** –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ—Ç–∞

–û—à–∏–±–∫–∞ 400 (Bad Request) –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞! üöÄ
