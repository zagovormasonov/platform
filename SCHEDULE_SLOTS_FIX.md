# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª–æ—Ç–æ–≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —ç–∫—Å–ø–µ—Ä—Ç–∞ –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ.

## üîç –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã

### 1. –§—É–Ω–∫—Ü–∏—è `generate_time_slots` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î
- –ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω `supabase-calendar.sql`
- –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ñ—É–Ω–∫—Ü–∏–∏

### 2. RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ RPC —Ñ—É–Ω–∫—Ü–∏–π
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–∞–±–ª–∏—Ü–∞–º

### 3. –û—à–∏–±–∫–∞ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö —Ñ—É–Ω–∫—Ü–∏–∏
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç
- –ù–µ–≤–µ—Ä–Ω—ã–π ID —ç–∫—Å–ø–µ—Ä—Ç–∞

## ‚úÖ –†–µ—à–µ–Ω–∏—è

### –†–µ—à–µ–Ω–∏–µ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### –ó–∞–ø—É—Å—Ç–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç:
```sql
-- –í—ã–ø–æ–ª–Ω–∏—Ç–µ check-and-fix-generate-slots.sql
-- –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
-- - –ü—Ä–æ–≤–µ—Ä–∏—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
-- - –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Å—Ç –µ—ë –µ—Å–ª–∏ –Ω—É–∂–Ω–æ  
-- - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
```

### –†–µ—à–µ–Ω–∏–µ 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ UI –∫–Ω–æ–ø–∫–∏

#### –í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ —ç–∫—Å–ø–µ—Ä—Ç–∞:
1. –û—Ç–∫—Ä–æ–π—Ç–µ "–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å"
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ —Ä–∞–∑–¥–µ–ª—É "–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–Ω—è—Ç–∏–π"  
3. –ù–∞–∂–º–∏—Ç–µ **"–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ—Ç—ã"** (–∑–µ–ª–µ–Ω–∞—è –∫–Ω–æ–ø–∫–∞)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏

### –†–µ—à–µ–Ω–∏–µ 3: –†—É—á–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ SQL

#### –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
```sql
-- –ü—Ä–∏–º–µ—Ä —Ä—É—á–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —ç–∫—Å–ø–µ—Ä—Ç–∞
-- –ó–∞–º–µ–Ω–∏—Ç–µ UUID –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π ID —ç–∫—Å–ø–µ—Ä—Ç–∞

SELECT generate_time_slots(
    '6da80dbf-4c09-46ba-a5de-16d36e3b64d0'::UUID,  -- ID —ç–∫—Å–ø–µ—Ä—Ç–∞
    '2025-09-17'::DATE,                              -- –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞
    '2025-10-17'::DATE                               -- –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è (30 –¥–Ω–µ–π)
);
```

## üîß –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### 1. –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ ExpertSchedule:
```javascript
console.log('–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª–æ—Ç–æ–≤ –¥–ª—è:', { expertId, startDate, endDate })
console.log('–°–ª–æ—Ç—ã —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã:', data)
console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞: —Å–æ–∑–¥–∞–Ω–æ —Å–ª–æ—Ç–æ–≤:', slotsCheck.count)
```

### 2. –ö–Ω–æ–ø–∫–∞ "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ—Ç—ã":
- ‚úÖ **–†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫** –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª–æ—Ç–æ–≤
- ‚úÖ **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ** –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
- ‚úÖ **–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** –≤ –∫–æ–Ω—Å–æ–ª–∏

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏:
```javascript
// Fallback: –ø—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –≤ –ë–î
const { data: functions } = await supabase
  .from('pg_proc')
  .select('proname')
  .eq('proname', 'generate_time_slots')
```

## üéØ –ü–æ—à–∞–≥–æ–≤–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞
–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ª–æ–≥–∏:
```
–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª–æ—Ç–æ–≤ –¥–ª—è: {expertId: "...", startDate: "2025-09-17", endDate: "2025-10-17"}
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—à–∏–±–∫–∏
–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É:
- `"function generate_time_slots does not exist"` ‚Üí –ó–∞–ø—É—Å—Ç–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç
- `"permission denied"` ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏
- `"invalid input syntax"` ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç

### –®–∞–≥ 3: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É
–ù–∞–∂–º–∏—Ç–µ **"–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ—Ç—ã"** –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –ü–æ—è–≤–∏–ª–∏—Å—å –ª–∏ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
- –ï—Å—Ç—å –ª–∏ –æ—à–∏–±–∫–∏ –∏–ª–∏ —É—Å–ø–µ—à–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- –û–±–Ω–æ–≤–∏–ª—Å—è –ª–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—å

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
–í –∫–∞–ª–µ–Ω–¥–∞—Ä–µ –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è:
- ‚úÖ **–°–∏–Ω–∏–µ —Å–ª–æ—Ç—ã** - –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é** - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–Ω–∏ –∏ –≤—Ä–µ–º—è
- ‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º

## üìä SQL –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π:
```sql
SELECT 
    es.*,
    p.full_name as expert_name
FROM expert_schedule es
LEFT JOIN profiles p ON p.id = es.expert_id
WHERE es.is_active = true
ORDER BY es.expert_id, es.day_of_week;
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤:
```sql
SELECT 
    ts.expert_id,
    COUNT(*) as total_slots,
    MIN(ts.slot_date) as first_date,
    MAX(ts.slot_date) as last_date
FROM time_slots ts
WHERE ts.slot_date >= NOW()::date
GROUP BY ts.expert_id;
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏:
```sql
SELECT 
    proname as function_name,
    prosrc as function_body
FROM pg_proc 
WHERE proname = 'generate_time_slots';
```

## üöÄ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

### –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
```
–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª–æ—Ç–æ–≤ –¥–ª—è: {expertId: "...", startDate: "...", endDate: "..."}
–°–ª–æ—Ç—ã —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã: null
–ü—Ä–æ–≤–µ—Ä–∫–∞: —Å–æ–∑–¥–∞–Ω–æ —Å–ª–æ—Ç–æ–≤: 42
```

### –í –∫–∞–ª–µ–Ω–¥–∞—Ä–µ —ç–∫—Å–ø–µ—Ä—Ç–∞:
- ‚úÖ **–°–∏–Ω–∏–µ —Å–ª–æ—Ç—ã** –ø–æ—è–≤–ª—è—é—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–Ω–∏** –Ω–µ–¥–µ–ª–∏ 
- ‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –≤—Ä–µ–º—è** –Ω–∞—á–∞–ª–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è
- ‚úÖ **–ù—É–∂–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** –∑–∞–Ω—è—Ç–∏–π

### –í –ø–∞–Ω–µ–ª–∏ –æ—Ç–ª–∞–¥–∫–∏:
```
üîß –ü–∞–Ω–µ–ª—å –æ—Ç–ª–∞–¥–∫–∏
–í—Å–µ–≥–æ —Å–ª–æ—Ç–æ–≤: 42      ‚Üê –£–≤–µ–ª–∏—á–∏–ª–æ—Å—å!
–î–æ—Å—Ç—É–ø–Ω—ã—Ö: 40         ‚Üê –ü–æ—è–≤–∏–ª–∏—Å—å!
–ù–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö: 2        ‚Üê –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ
–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π: 2
```

## üéØ –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–±:
1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ** `check-and-fix-generate-slots.sql` –≤ Supabase
2. **–û–±–Ω–æ–≤–∏—Ç–µ** —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
3. **–ù–∞–∂–º–∏—Ç–µ** "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ—Ç—ã" –≤ –ø—Ä–æ—Ñ–∏–ª–µ —ç–∫—Å–ø–µ—Ä—Ç–∞
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ** –∫–∞–ª–µ–Ω–¥–∞—Ä—å - –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Å–ª–æ—Ç—ã

–ü—Ä–æ–±–ª–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–µ—à–µ–Ω–∞! üéâ
