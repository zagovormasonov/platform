# WebSocket Chat Server

## Установка и запуск

### 1. Установка зависимостей
```bash
# Переименуйте websocket-package.json в package.json
mv websocket-package.json package.json

# Установите зависимости
npm install
```

### 2. Запуск сервера
```bash
# Обычный запуск
npm start

# Или с автоперезагрузкой (для разработки)
npm run dev
```

### 3. Настройка порта
По умолчанию сервер запускается на порту 8080. Для изменения порта установите переменную окружения:
```bash
PORT=3001 npm start
```

## Архитектура

### WebSocket сервер (`websocket-server.js`)
- Обрабатывает подключения пользователей
- Управляет чатами и сообщениями
- Отправляет уведомления в реальном времени
- Поддерживает автоматическое переподключение

### WebSocket клиент (`src/hooks/useWebSocketChat.ts`)
- Подключается к серверу
- Отправляет и получает сообщения
- Управляет состоянием чата
- Обновляет счетчик непрочитанных сообщений

### Компонент чата (`src/components/ChatModalWebSocket.tsx`)
- Использует WebSocket хук
- Отображает сообщения в реальном времени
- Управляет UI чата

## Преимущества WebSocket решения

1. **Стабильность**: Нет мигания индикатора
2. **Производительность**: Прямое соединение без промежуточных слоев
3. **Надежность**: Автоматическое переподключение
4. **Масштабируемость**: Легко добавить новые функции

## Интеграция с существующим кодом

WebSocket чат полностью заменяет Supabase Realtime чат:
- Удалите старый `ChatModal.tsx`
- Используйте `ChatModalWebSocket.tsx`
- Счетчик непрочитанных сообщений работает стабильно
- Сохранение в localStorage больше не нужно

## Тестирование

1. Запустите WebSocket сервер
2. Откройте приложение
3. Откройте чат
4. Отправьте сообщение
5. Проверьте стабильность индикатора

